<html lang="en">
<head>
	<meta charset="UTF-8">
	<style>
		table {
			border-spacing: 0;
			margin: 0;
			padding: 0;
			
			border-right: 1px solid black;
			border-bottom: 1px solid black;
		}
		
		.tile {
			border-top: 1px solid black;
			border-left: 1px solid black;
			width: 70px;
			height: 70px;
			margin: 0;
		}

		tr:nth-child(2n), td:nth-child(2n)  {
			background-color: gray;
		}

		tr:nth-child(2n) td:nth-child(2n) {
			background-color: white;
		}

		td {
			text-align: center;
		}

		.figure {
			font-size: 50px;
		}

		.light {
			color: gold;
		}
	</style>
</head>
<body>

	<table>
		<tbody id="chessboard"></tbody>
	</table>

	<script>
		let currentField = '';

		/// figures
		const figures = {
			'bishop': {
				display: '&#9815;',
				field: '1_3'
			},
			'tower': { 
				display: '&#9814;',
				field: '1_1'
			},
			'knight': {
				display: '&#9816;',
				field: '1_2',
			},
		}

		const drawFigure = (figureName, figureData) => {
			const figureEL = document.createElement("span");
			figureEL.innerHTML = figureData['display'];
			figureEL.id = figureData['field'];
			figureEL.className = 'figure ' + figureName + (currentField == figureData['field'] ? ' light' : '');

			document.getElementById(figureData['field']).appendChild(figureEL);
		}

		const updateFigure = (figureName, figureData) => {
			const element = document.getElementsByClassName(figureName);
			console.warn (element[0].id + ' ' + figureData['field']);
			element[0].remove();

			drawFigure(figureName, figureData);
		}

		const checkIsPossibleForBishop = (navigateTo) => {
			const from = currentField.split('_');
			const to = navigateTo.split('_');

			return Math.abs(from[0] - to[0]) == Math.abs(from[1] - to[1]);
		}

		const checkIsPossibleForTower = (navigateTo) => {
			const from = currentField.split('_');
			const to = navigateTo.split('_');

			return from[0] === to[0] || from[1] === to[1];
		}

		const checkIsPossibleForKnight = (navigateTo) => {
			const from = currentField.split('_');
			const to = navigateTo.split('_');

			return (Math.abs(from[0] - to[0]) == 1 && Math.abs(from[1] - to[1]) == 2) 
			|| (Math.abs(from[0] - to[0]) == 2 && Math.abs(from[1] - to[1]) == 1);
		}

		const onFieldClick = (ev) => {
			const fieldCoords = ev.target.id;
			const figureOnNewTile = Object.entries(figures).find((e) => e[1]['field'] === fieldCoords);

			if(currentField != '' && !figureOnNewTile) {
				const figureOnTile = Object.entries(figures)
					.find((e) => e[1]['field'] === currentField);

				if(figureOnTile) {
					/// figure is selected and is intended to be moved
					let result = false;
					switch(figureOnTile[0]) {
						case 'bishop':{
							result = checkIsPossibleForBishop(fieldCoords);
							break;
						}
						case 'knight':{
							result = checkIsPossibleForKnight(fieldCoords);
							break;
						}
						case 'tower':{
							result = checkIsPossibleForTower(fieldCoords);
							break;
						}
						default:
							result = false;
					}

					if(result) {
						figures[figureOnTile[0]] = {
						'display': figureOnTile[1]['display'],
						'field': fieldCoords,
						}

						updateFigure(figureOnTile[0], figures[figureOnTile[0]]);
					} else {
						alert ('This move is not allowed for: ' + figureOnTile[0]);
					}
				} else {
					currentField = fieldCoords;
				}


			} else {
				currentField = fieldCoords;

				if(figureOnNewTile) {
					updateFigure(figureOnNewTile[0], figures[figureOnNewTile[0]]);
				}
			}

		}

		/// chessboard setup
		const boardSize = 8;
		const array = Array.apply(0, Array(boardSize));
		const chessboard = document.getElementById("chessboard");

		array.forEach((_, oi) => {
			const horizontal = document.createElement("tr");
			
			array.forEach((_, ii) => {
				const tile = document.createElement("td");
				tile.className = 'tile';
				tile.id = (oi + 1) + '_' + (ii + 1);
				tile.addEventListener('click', onFieldClick);
				horizontal.appendChild(tile);
			});

			chessboard.appendChild(horizontal);
		})

		
		Object.entries(figures).forEach((el) => drawFigure(el[0], el[1]));
		
	</script>

</body>
</html>